<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mostrar Información por Niveles</title>
    <link rel="stylesheet" href="styles.css"> <!-- Enlaza el CSS aquí -->
</head>
<body>
    <h1>Ymir Hechizera nivel 10</h1>

    <!-- Puntos de Hechicería -->
    <div id="puntos-hechiceria">
        <h2>Puntos de Hechicería</h2>
        <div id="hechiceria-diamonds">
            <!-- Filas de diamantes -->
            <div class="diamond-row">
                <div class="diamond" data-diamond-id="diamond1"></div>
                <div class="diamond" data-diamond-id="diamond2"></div>
                <div class="diamond" data-diamond-id="diamond3"></div>
                <div class="diamond" data-diamond-id="diamond4"></div>
                <div class="diamond" data-diamond-id="diamond5"></div>
            </div>
            <div class="diamond-row">
                <div class="diamond" data-diamond-id="diamond6"></div>
                <div class="diamond" data-diamond-id="diamond7"></div>
                <div class="diamond" data-diamond-id="diamond8"></div>
                <div class="diamond" data-diamond-id="diamond9"></div>
                <div class="diamond" data-diamond-id="diamond10"></div>
            </div>
        </div>
    </div>

    <!-- Hechizos por Niveles -->
    <div id="hechizos">
        <h2>Hechizos</h2>
        <div id="info">Cargando información...</div>
    </div>

    <!-- Botón para limpiar el cache -->
    <div id="limpiar">
        <button id="limpiarCache">Limpiar Hoja</button>
    </div>

    <script>
        // Función para guardar el estado en localStorage
        function saveState(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        }

        // Función para cargar el estado desde localStorage
        function loadState(key) {
            return JSON.parse(localStorage.getItem(key));
        }

        // Cargar el archivo JSON
        fetch('data.json')
            .then(response => response.json())
            .then(data => {
                const infoDiv = document.getElementById('info');
                infoDiv.innerHTML = ''; // Limpiar el contenido previo

                // Crear un objeto para agrupar los elementos por nivel
                const levels = {};
                data.items.forEach(item => {
                    if (!levels[item.nivel]) {
                        levels[item.nivel] = [];
                    }
                    levels[item.nivel].push(item);
                });

                // Recorrer los niveles y mostrarlos
                for (let level = 1; level <= 5; level++) {
                    const levelDiv = document.createElement('div');
                    levelDiv.className = 'level';

                    // Contenedor flex para nivel y diamantes
                    const levelHeader = document.createElement('div');
                    levelHeader.className = 'level-header'; // Clase para flexbox

                    const levelTitle = document.createElement('h3');
                    levelTitle.innerHTML = `Nivel ${level}`;

                    // Crear contenedor para los diamantes
                    const diamondContainer = document.createElement('div');
                    diamondContainer.className = 'diamond-container';

                    let diamondCount = 0;
                    if (level === 1) {
                        diamondCount = 4; // 4 diamantes para nivel 1
                    } else if (level <= 4) {
                        diamondCount = 3; // 3 diamantes para niveles 2, 3 y 4
                    } else {
                        diamondCount = 1; // 1 diamante para nivel 5
                    }

                    for (let i = 0; i < diamondCount; i++) {
                        const diamond = document.createElement('div');
                        diamond.className = 'diamond';
                        diamond.dataset.diamondId = `nivel${level}-diamond${i}`;
                        
                        // Restaurar estado de los diamantes desde localStorage
                        const savedDiamonds = loadState(`nivel${level}-diamonds`);
                        if (savedDiamonds && savedDiamonds[i]) {
                            diamond.classList.add('active');
                        }

                        diamond.addEventListener('click', function() {
                            diamond.classList.toggle('active');
                            saveDiamondsState(level);
                        });

                        diamondContainer.appendChild(diamond);
                    }

                    levelHeader.appendChild(levelTitle);
                    levelHeader.appendChild(diamondContainer);
                    levelDiv.appendChild(levelHeader); // Agregar nivel y diamantes al levelDiv

                    // Crear un contenedor para los hechizos
                    const spellsContainer = document.createElement('div');
                    spellsContainer.className = 'spells-container';

                    // Verificar si el nivel estaba expandido en el cache
                    const isExpanded = loadState(`nivel${level}-expanded`);
                    spellsContainer.style.display = isExpanded ? 'block' : 'none'; // Ocultar por defecto

                    // Evento para mostrar/ocultar los hechizos al hacer clic en el título del nivel
                    levelTitle.addEventListener('click', function() {
                        spellsContainer.style.display = spellsContainer.style.display === 'none' ? 'block' : 'none';
                        saveState(`nivel${level}-expanded`, spellsContainer.style.display === 'block');
                    });

                    if (levels[level]) {
                        levels[level].forEach(item => {
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'item'; // Agregar la clase item
                            let content = `<strong>${item.nombre}</strong><br><div class="item-content" style="display:none;">`;

                            // Solo agregar las filas si tienen valor
                            if (item.daño) {
                                content += `<strong>Daño:</strong> ${item.daño}<br>`;
                            }

                            if (item.alcance) {
                                content += `<strong>Alcance:</strong> ${item.alcance}<br>`;
                            }
                            if (item.Concentracion) {
                                content += `<strong>Concentración:</strong> ${item.Concentracion}<br>`;
                            }
                            content += `<strong>Descripción:</strong> ${item.descripcion}<br>`;
                            content += '</div>';

                            itemDiv.innerHTML = content;

                            // Agregar evento de clic para mostrar/ocultar la descripción del hechizo
                            itemDiv.addEventListener('click', function() {
                                const itemContent = itemDiv.querySelector('.item-content');
                                itemContent.style.display = itemContent.style.display === 'none' ? 'block' : 'none'; // Toggle visibility
                            });

                            spellsContainer.appendChild(itemDiv); // Agregar hechizo al contenedor
                        });
                    }

                    levelDiv.appendChild(spellsContainer); // Agregar contenedor de hechizos al nivel
                    infoDiv.appendChild(levelDiv); // Agregar el nivel completo al contenedor principal
                }
            })
            .catch(error => {
                console.error('Error al cargar el JSON:', error);
                document.getElementById('info').innerText = 'Error al cargar la información.';
            });

        // Función para guardar el estado de los diamantes por nivel
        function saveDiamondsState(level) {
            const diamonds = document.querySelectorAll(`[data-diamond-id^="nivel${level}-diamond"]`);
            const diamondsState = Array.from(diamonds).map(diamond => diamond.classList.contains('active'));
            saveState(`nivel${level}-diamonds`, diamondsState);
        }

        // Función para guardar el estado de los diamantes de Puntos de Hechicería
        function saveHechiceriaDiamondsState() {
            const diamonds = document.querySelectorAll('#hechiceria-diamonds .diamond');
            const diamondsState = Array.from(diamonds).map(diamond => diamond.classList.contains('active'));
            saveState('hechiceriaDiamondsState', diamondsState);
        }

        // Restaurar el estado de los diamantes de Puntos de Hechicería
        function restoreHechiceriaDiamondsState() {
            const savedDiamondsState = loadState('hechiceriaDiamondsState');
            if (savedDiamondsState) {
                const diamonds = document.querySelectorAll('#hechiceria-diamonds .diamond');
                diamonds.forEach((diamond, index) => {
                    if (savedDiamondsState[index]) {
                        diamond.classList.add('active');
                    }
                });
            }
        }

        // Cambiar color de los diamantes de Puntos de Hechicería al hacer clic
        document.querySelectorAll('#hechiceria-diamonds .diamond').forEach(diamond => {
            diamond.addEventListener('click', function() {
                diamond.classList.toggle('active');
                saveHechiceriaDiamondsState();
            });
        });

        // Restaurar estado al cargar la página
        restoreHechiceriaDiamondsState();

        // Limpiar localStorage y refrescar la página
        document.getElementById('limpiarCache').addEventListener('click', function() {
            localStorage.clear(); // Limpiar el cache local
            location.reload(); // Recargar la página
        });
    </script>
</body>
</html>
